{"createdAt":"2025-06-13T14:45:27.664Z","updatedAt":"2025-06-25T21:22:00.000Z","id":"oJ0TWrfUFGscNLHN","name":"Car Odometer","active":false,"isArchived":false,"nodes":[{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.message.chat.id }}","rightValue":-4859562102,"operator":{"type":"number","operation":"equals"},"id":"566c6c0d-ee72-4428-a62f-e50c96e7db0f"}],"combinator":"and"},"renameOutput":true,"outputKey":"allowedChat"}]},"options":{}},"id":"8ed8f759-5cbf-465a-80e1-28010ef576e3","name":"Check Chat ID","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-160,440]},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"leftValue":"={{ $json.message.photo }}","rightValue":"","operator":{"type":"array","operation":"exists","singleValue":true},"id":"18078eae-2e01-4cb7-832d-9ffbd29c8917"}],"combinator":"and"},"renameOutput":true,"outputKey":"hasImage"}]},"options":{}},"id":"8bd8539b-bc5d-487d-8ace-27ab1ab32a42","name":"Check if Image","type":"n8n-nodes-base.switch","typeVersion":3,"position":[40,340],"onError":"continueErrorOutput"},{"parameters":{"assignments":{"assignments":[{"id":"prompt-assignment","name":"prompt","value":"Analyze this car dashboard image and extract the odometer/kilometer reading. Look for:\n\n1. Digital or analog odometer display\n2. Total distance/mileage counter\n3. Any numbers indicating kilometers driven\n4. Trip meter readings\n\nProvide the exact number of kilometers shown on the odometer. If you can see multiple readings (like trip A, trip B, total), focus on the TOTAL odometer reading.\n\nRespond with the kilometer reading in this format:\nOdometer: [NUMBER] km\n\nIf you cannot clearly read the odometer, explain what you can see and why the reading is unclear.","type":"string"}]},"options":{}},"id":"741d641f-1d2c-4fa8-bbe5-782b305400f2","name":"Set OCR Prompt","type":"n8n-nodes-base.set","typeVersion":3.3,"position":[240,240]},{"parameters":{"chatId":"={{ $json.message.chat.id }}","text":"Please send an image of your car's dashboard showing the odometer/kilometer reading. ðŸ“¸ðŸš—","additionalFields":{"appendAttribution":false}},"id":"e6493a61-4b95-4d70-86b8-eeec5bedcc3e","name":"Request Image","type":"n8n-nodes-base.telegram","typeVersion":1.1,"position":[240,440],"webhookId":"8e1a7a7b-6218-4d9a-92be-2a3597e5d53b"},{"parameters":{"content":"## Car Odometer OCR Workflow (Chat ID Restricted)\n\nThis workflow:\n1. **Receives images** from Telegram\n2. **Checks** if message is from authorized chat ID\n3. **Validates** if message contains an image\n4. **Analyzes** the image using OpenAI Vision\n5. **Extracts** kilometer readings using OCR\n6. **Sends results** back to the same Telegram group\n\n### Setup Required:\n- Telegram Bot Token\n- OpenAI API Key with Vision model access\n- **Update Chat ID** in \"Check Chat ID\" node\n\n### Security:\n- Only processes messages from specified chat ID\n- Unauthorized chats are ignored silently","height":490,"width":400,"color":7},"id":"73e4ed2d-598d-4ffe-b881-3b55ff76172c","name":"Workflow Info","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-400,-100]},{"parameters":{"content":"## Chat ID Configuration\n\n**IMPORTANT:** Update the Chat ID in the \"Check Chat ID\" node!\n\n1. Replace `-1001234567890` with your actual chat ID\n2. To get your chat ID:\n   - Add the bot to your group\n   - Send a message\n   - Check bot logs or use @userinfobot\n   - Group IDs start with `-100`\n   - Private chats have positive numbers\n\n**Security:** Messages from other chats are silently ignored.","height":370,"width":350,"color":4},"id":"61af6db2-bd04-44c8-85b9-0031e23fe049","name":"Chat ID Setup","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-400,620]},{"parameters":{"updates":["message"],"additionalFields":{"download":true}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-380,440],"id":"78710b54-29fb-44f5-b2c9-90cf99ea89a1","name":"Telegram Trigger1","webhookId":"d1ff9152-2307-4930-9050-5ef9a4f7721b"},{"parameters":{"mode":"runOnceForEachItem","jsCode":"// Extract kilometers from OCR analysis\nconst analysis = $input.item.json.content || $input.item.json.text || '';\n\n// Common patterns for odometer readings\nconst patterns = [\n  /(?:odometer|odo|mileage|km|kilometers?)\\s*:?\\s*([0-9,\\.\\s]+)\\s*(?:km|kilometers?)?/i,\n  /([0-9]{1,3}(?:[,\\.]?[0-9]{3})*(?:\\.[0-9]+)?)\\s*(?:km|kilometers?)/i,\n  /total\\s*(?:distance|km|kilometers?)\\s*:?\\s*([0-9,\\.\\s]+)/i,\n  /([0-9]{3,6})\\s*(?:km|kilometers?)/i\n];\n\nlet extractedKm = null;\nlet confidence = 'low';\n\n// Try each pattern\nfor (const pattern of patterns) {\n  const match = analysis.match(pattern);\n  if (match) {\n    let kmValue = match[1].replace(/[,\\s]/g, '').replace(/\\.$/, '');\n    const numValue = parseFloat(kmValue);\n    \n    // Validate reasonable odometer reading (between 0 and 999,999 km)\n    if (!isNaN(numValue) && numValue >= 0 && numValue <= 999999) {\n      extractedKm = Math.round(numValue);\n      confidence = 'high';\n      break;\n    }\n  }\n}\n\n// Fallback: extract any number that looks like an odometer reading\nif (!extractedKm) {\n  const numbers = analysis.match(/\\b([0-9]{4,6})\\b/g);\n  if (numbers) {\n    for (const num of numbers) {\n      const value = parseInt(num);\n      if (value >= 1000 && value <= 999999) {\n        extractedKm = value;\n        confidence = 'medium';\n        break;\n      }\n    }\n  }\n}\n\nreturn {\n  originalAnalysis: analysis,\n  extractedKilometers: extractedKm,\n  confidence: confidence,\n  chatId: $input.item.json.message?.chat?.id,\n  messageId: $input.item.json.message?.message_id,\n  formattedKm: extractedKm ? extractedKm.toLocaleString() : null\n};"},"id":"41126c74-3ba2-4efe-be5c-ce15fa9f2c80","name":"Extract Kilometers","type":"n8n-nodes-base.code","typeVersion":2,"position":[980,240]},{"parameters":{"chatId":"={{ $json.chatId }}","text":"={{ $json.extractedKilometers ? `ðŸš— Car Odometer Reading Detected!\\n\\nðŸ“Š **Kilometers:** ${$json.formattedKm} km\\nðŸŽ¯ **Confidence:** ${$json.confidence}\\n\\n${$json.confidence === 'low' ? 'âš ï¸ Low confidence reading - please verify the number manually.' : 'âœ… Reading extracted successfully!'}` : 'âŒ Could not detect odometer reading in the image.\\n\\nPlease ensure the image shows a clear view of the car dashboard with visible kilometer reading.' }}","additionalFields":{"appendAttribution":false}},"id":"f03ed9a3-f232-4e4d-a0e6-a954c1ec6f13","name":"Send OCR Result","type":"n8n-nodes-base.telegram","typeVersion":1.1,"position":[1260,240],"webhookId":"756176fd-90e2-4135-a87a-778a1fc4af8e"},{"parameters":{"model":"meta-llama/llama-4-scout-17b-16e-instruct","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGroq","typeVersion":1,"position":[500,460],"id":"2c58522c-4338-41bf-843c-2edf6f815fad","name":"Groq Chat Model"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[580,240],"id":"06caeb9b-548c-4972-8503-9a5241744bdf","name":"AI Agent"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[680,460],"id":"9dc82e39-a283-478b-a3d6-ece09ed1fa53","name":"Simple Memory"}],"connections":{"Check Chat ID":{"main":[[{"node":"Check if Image","type":"main","index":0}]]},"Check if Image":{"main":[[{"node":"Set OCR Prompt","type":"main","index":0}],[{"node":"Request Image","type":"main","index":0}]]},"Set OCR Prompt":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Telegram Trigger1":{"main":[[{"node":"Check Chat ID","type":"main","index":0}]]},"Extract Kilometers":{"main":[[{"node":"Send OCR Result","type":"main","index":0}]]},"Groq Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Extract Kilometers","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"d4042381-821c-4df6-b112-ee41fda76ddc","triggerCount":0,"shared":[{"createdAt":"2025-06-13T14:45:27.676Z","updatedAt":"2025-06-13T14:45:27.676Z","role":"workflow:owner","workflowId":"oJ0TWrfUFGscNLHN","projectId":"uOq34c8HjhQfCJ55"}],"tags":[]}